<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luksood GU.</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <style>
        /* จัดรูปแบบให้มีพื้นหลังเป็นภาพ */
        .body1 {
            background-image: url('dna.png'); /* ใส่ที่อยู่ของภาพ */
            background-size: cover;
            background-position: center;
            padding: 20px;
            height: 100vh; /* ให้ขนาดสูงเต็มหน้าจอ */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .whitebox3 {
            background: rgba(255, 255, 255, 0.8); /* ให้พื้นหลังเป็นสีขาวโปร่งใส */
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .charts-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .btn2 {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }

        .btn2:hover {
            background-color: #45a049;
        }

        .faculty-details {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
            display: none; /* ซ่อนรายละเอียดก่อน */
            text-align: left;
            text-align: center;
        }
    </style>
</head>

<header>
    <div class="logo">
        <img src="detective.png" alt="Logo">
        <span>Luksood GU.</span>
    </div>
    <span style="font-size: 30px;">คณะที่แนะนำ</span>
    <div class="right-text">
        <span>แนะนำคณะที่ใช่</span>
    </div>
</header>

<body>
    <div class="body">
        <div class="body1">
            <div class="imegebox3">
                <div class="whitebox3">
                    <h1>ผลลัพธ์</h1>
                    <!-- แสดงผลคณะที่เหมาะสม -->
                    <div class="result-box">
                        <h3>คณะที่เหมาะสมกับคุณ:</h3>
                        <li id="rank1"></li> <!-- แสดงอันดับที่ 1 -->
                        <li id="rank2"></li> <!-- แสดงอันดับที่ 2 -->
                        <li id="rank3"></li> <!-- แสดงอันดับที่ 3 -->
                    </div>
                    <!-- แสดงกราฟ Pie Chart -->
                    <div class="charts-container">
                        <div style="width: 50%; text-align: center;">
                            <canvas id="chart1"></canvas>
                        </div>
                    </div>

                    <!-- รายละเอียดของคณะที่เลือก -->
                    <div id="facultyDetails" class="faculty-details"></div>
                </div>
            </div>
        </div>

        <!-- ปุ่ม NEXT -->
        <div class="botton">
            <form action="Assessment.html">
                <p>ทำแบบประเมิน</p>
                <div class="input-group">
                    <button type="submit" class="btn2">NEXT</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            recommendFaculty();
        });

        function recommendFaculty() {
            let riasecScores = {
                R: parseInt(localStorage.getItem('totalScore_R')) || 0,
                I: parseInt(localStorage.getItem('totalScore_I')) || 0,
                A: parseInt(localStorage.getItem('totalScore_A')) || 0,
                S: parseInt(localStorage.getItem('totalScore_S')) || 0,
                E: parseInt(localStorage.getItem('totalScore_E')) || 0,
                C: parseInt(localStorage.getItem('totalScore_C')) || 0
            };

            let mbtiResult = localStorage.getItem('MBTI_result') || "";
            let facultyList = [
                { name: "คณะเทคโนโลยีการเกษตร", score: (riasecScores.R + riasecScores.I + riasecScores.C), mbti: ["ISTJ", "ISFJ", "ESTP", "ENTJ"], details: "เหมาะกับคนชอบธรรมชาติ สนใจการพัฒนาเกษตรกรรม เทคโนโลยี และการจัดการ" },
                { name: "คณะเทคโนโลยีคหกรรมศาสตร์", score: (riasecScores.R + riasecScores.A + riasecScores.C), mbti: ["ESFJ", "ISFJ", "ESTJ"], details: "เหมาะกับคนชอบงานบ้าน อาหาร แฟชั่น การออกแบบผลิตภัณฑ์ที่ใช้ในชีวิตประจำวัน" },
                { name: "คณะเทคโนโลยีสื่อสารมวลชน", score: (riasecScores.A + riasecScores.E + riasecScores.S), mbti: ["ENFP", "ESFP", "INFJ", "ENTJ"], details: "เหมาะกับคนที่ชอบการสื่อสาร การเล่าเรื่อง การผลิตสื่อทั้งแบบดั้งเดิมและดิจิทัล" },
                { name: "คณะการแพทย์บูรณาการ", score: (riasecScores.I + riasecScores.S + riasecScores.C), mbti: ["INFJ", "ENFJ", "ISFJ", "ISTJ"], details: "เหมาะกับคนที่สนใจศาสตร์ทางการแพทย์ สุขภาพ และต้องการช่วยเหลือผู้อื่น" },
                { name: "คณะครุศาสตร์อุตสาหกรรม", score: (riasecScores.R + riasecScores.S + riasecScores.E), mbti: ["ESTJ", "ESFJ", "ISTP", "ENTJ"], details: "เหมาะกับคนที่ชอบงานสอน ควบคู่กับการใช้เทคโนโลยีและนวัตกรรมอุตสาหกรรม" },
                { name: "คณะบริหารธุรกิจ", score: (riasecScores.E + riasecScores.C + riasecScores.S), mbti: ["ENTJ", "ESTP", "ESFP", "ISTJ"], details: "เหมาะกับคนที่ชอบการจัดการ วางแผนธุรกิจ หรือทำงานด้านการตลาด การเงิน" },
                { name: "คณะพยาบาลศาสตร์", score: (riasecScores.S + riasecScores.C + riasecScores.I), mbti: ["ESFJ", "ISFJ", "INFJ", "ENFJ"], details: "เหมาะกับคนที่มีความเมตตา ต้องการดูแลช่วยเหลือผู้อื่น และทำงานอย่างเป็นระบบ" },
                { name: "คณะวิทยาศาสตร์และเทคโนโลยี", score: (riasecScores.I + riasecScores.R + riasecScores.C), mbti: ["INTJ", "ISTJ", "INTP", "ISTP"], details: "เหมาะกับคนที่ชอบการวิเคราะห์ ค้นคว้า คิดเชิงตรรกะ และแก้ปัญหาเชิงวิทยาศาสตร์" },
                { name: "คณะวิศวกรรมศาสตร์", score: (riasecScores.R + riasecScores.I + riasecScores.C), mbti: ["ISTP", "INTJ", "ESTJ", "ENTJ"], details: "เหมาะกับคนที่ชอบงานเทคนิค คำนวณ ระบบเครื่องจักร และการออกแบบโครงสร้าง" },
                { name: "คณะศิลปกรรมศาสตร์", score: (riasecScores.A + riasecScores.R + riasecScores.E), mbti: ["INFP", "ENFP", "ISFP", "ESFP"], details: "เหมาะกับคนที่มีความคิดสร้างสรรค์ ชอบการออกแบบ ศิลปะ ดนตรี หรือการแสดง" },
                { name: "คณะศิลปศาสตร์", score: (riasecScores.A + riasecScores.S + riasecScores.I), mbti: ["INFJ", "ENFP", "INFP", "ISFP"], details: "เหมาะกับคนที่สนใจด้านภาษา วรรณกรรม จิตวิทยา หรือปรัชญา" },
                { name: "คณะสถาปัตยกรรมศาสตร์", score: (riasecScores.A + riasecScores.R + riasecScores.I), mbti: ["INTJ", "INTP", "ISFP", "ENFP"], details: "เหมาะกับคนที่สนใจการออกแบบเชิงสร้างสรรค์ และมีทักษะเชิงเทคนิคด้านโครงสร้าง" }
            ];

            let matchedFaculties = facultyList.filter(faculty => faculty.mbti.includes(mbtiResult));
            matchedFaculties.sort((a, b) => b.score - a.score);
            let top3 = matchedFaculties.slice(0, 3);

            // แสดงอันดับที่ 1, 2, 3
            if (top3.length > 0) {
                document.getElementById('rank1').innerText = `อันดับที่ 1: ${top3[0].name} (คะแนน: ${top3[0].score})`;
                document.getElementById('rank2').innerText = `อันดับที่ 2: ${top3[1].name} (คะแนน: ${top3[1].score})`;
                document.getElementById('rank3').innerText = `อันดับที่ 3: ${top3[2].name} (คะแนน: ${top3[2].score})`;

                // แสดงกราฟ
                const chartLabels = top3.map(item => item.name);
                const chartData = top3.map(item => item.score);
                const chartColors = ['#FF6384', '#36A2EB', '#FFCE56'];

                const ctx1 = document.getElementById('chart1').getContext('2d');
                const myChart = new Chart(ctx1, {
                    type: 'pie',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            data: chartData,
                            backgroundColor: chartColors,
                        }]
                    },
                    options: {
                        responsive: true,
                        onClick: (e) => {
                            const activePoints = myChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true);
                            if (activePoints.length > 0) {
                                const idx = activePoints[0].index;
                                const facultyDetails = top3[idx].details;
                                document.getElementById('facultyDetails').innerText = facultyDetails;
                                document.getElementById('facultyDetails').style.display = 'block'; // แสดงรายละเอียด
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: {
                                        size: 13
                                    }
                                }
                            },
                            datalabels: {
                                color: '#000',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                },
                                formatter: (value, ctx) => {
                                    let label = ctx.chart.data.labels[ctx.dataIndex];
                                    return label + "\n(" + value + " คะแนน)";
                                }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            } else {
                alert("ไม่พบคณะที่ตรงกับผลลัพธ์ของคุณ");
            }
        }

    </script>
</body>

</html>
