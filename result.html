<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คณะที่เหมาะกับคุณ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <style>
        /* จัดรูปแบบให้มีพื้นหลังเป็นภาพ */
        .body1 {
            background-image: url('dna.png'); /* ใส่ที่อยู่ของภาพ */
            background-size: cover;
            background-position: center;
            padding: 20px;
            height: 100vh; /* ให้ขนาดสูงเต็มหน้าจอ */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .whitebox3 {
            background: rgba(255, 255, 255, 0.8); /* ให้พื้นหลังเป็นสีขาวโปร่งใส */
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .charts-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        canvas {
            width: 100% !important;
            height: 320px !important;
        }

        .btn2 {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }

        .btn2:hover {
            background-color: #45a049;
        }
    </style>
</head>

<header>
    <div class="logo">
        <img src="detective.png" alt="Logo">
        <span>Luksood GU.</span>
    </div>
    <span style="font-size: 30px;">คณะที่แนะนำ</span>
    <div class="right-text">
        <span>แนะนำคณะที่ใช่</span>
    </div>
</header>


<body>
    <div class="body">
        <div class="body1">
            <div class="imegebox3">
                <div class="whitebox3">
                    <h1 style="text-align: center;">ผลลัพธ์</h1>
                    <!-- แสดงกราฟ Pie Chart -->
                    <div class="charts-container">
                        <div style="width: 50%;">
                            <canvas id="chart1"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="botton">
            <form action="Assessment.html">
                <p>ทำแบบประเมิน</p>
                <div class="input-group">
                    <button type="submit" class="btn2">NEXT</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            recommendFaculty();
        });
    
        function recommendFaculty() {
            let riasecScores = {
                R: parseInt(localStorage.getItem('totalScore_R')) || 0,
                I: parseInt(localStorage.getItem('totalScore_I')) || 0,
                A: parseInt(localStorage.getItem('totalScore_A')) || 0,
                S: parseInt(localStorage.getItem('totalScore_S')) || 0,
                E: parseInt(localStorage.getItem('totalScore_E')) || 0,
                C: parseInt(localStorage.getItem('totalScore_C')) || 0
            };
    
            let mbtiResult = localStorage.getItem('MBTI_result') || "";
            let faculties = [];
    
            let facultyList = [
                { name: "คณะเทคโนโลยีการเกษตร", score: riasecScores.R + riasecScores.I, mbti: ["ISFJ", "ISTJ", "ESTP", "ESFP"] },
                { name: "คณะเทคโนโลยีคหกรรมศาสตร์", score: riasecScores.A + riasecScores.C, mbti: ["ISFP", "ESFP", "INFJ", "ENFJ"] },
                { name: "คณะเทคโนโลยีสื่อสารมวลชน", score: riasecScores.A + riasecScores.S, mbti: ["ENFP", "ENFJ", "ESFP", "INFP"] },
                { name: "คณะการแพทย์บูรณาการ", score: riasecScores.I + riasecScores.S, mbti: ["ISFJ", "INFJ", "ENFJ", "ESFJ"] },
                { name: "คณะครุศาสตร์อุตสาหกรรม", score: riasecScores.I + riasecScores.E, mbti: ["ISTJ", "ISFJ", "ESTJ", "ENTJ"] },
                { name: "คณะบริหารธุรกิจ", score: riasecScores.E + riasecScores.C, mbti: ["ENTJ", "ESTJ", "ENFP", "ESFJ"] },
                { name: "คณะพยาบาลศาสตร์", score: riasecScores.S + riasecScores.I, mbti: ["ISFJ", "ESFJ", "INFJ", "ENFJ"] },
                { name: "คณะวิทยาศาสตร์และเทคโนโลยี", score: riasecScores.I + riasecScores.R, mbti: ["INTJ", "INTP", "ISTP", "ISTJ"] },
                { name: "คณะวิศวกรรมศาสตร์", score: riasecScores.R + riasecScores.I, mbti: ["ISTJ", "ESTJ", "INTJ", "ISTP"] },
                { name: "คณะศิลปกรรมศาสตร์", score: riasecScores.A, mbti: ["INFP", "ISFP", "ENFP", "ENFJ"] },
                { name: "คณะศิลปศาสตร์", score: riasecScores.S + riasecScores.A, mbti: ["INFJ", "ENFJ", "ISFJ", "ESFJ"] },
                { name: "คณะสถาปัตยกรรมศาสตร์", score: riasecScores.A + riasecScores.R, mbti: ["INFP", "INTJ", "ISFP", "ENFP"] }
            ];
    
            let matchedFaculties = facultyList.filter(faculty => faculty.mbti.includes(mbtiResult));
            matchedFaculties.sort((a, b) => b.score - a.score);
            let top3 = matchedFaculties.slice(0, 3);
    
            if (top3.length > 0) {
                let resultText = `<h2>คณะที่เหมาะสมกับคุณ:</h2><ul>` + 
                    top3.map(item => `<li>${item.name} (คะแนน: ${item.score})</li>`).join("") + `</ul>`;
                
                alert("3 คณะที่เหมาะสมกับคุณ:\n" + top3.map(item => `${item.name} (${item.score})`).join("\n"));
    
                // สร้างกราฟและแสดงคะแนนภายใน Pie Chart
                const chartLabels = top3.map(item => item.name);
                const chartData = top3.map(item => item.score);
                const chartColors = ['#FF6384', '#36A2EB', '#FFCE56'];
    
                const ctx1 = document.getElementById('chart1').getContext('2d');
                new Chart(ctx1, {
                    type: 'pie',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            data: chartData,
                            backgroundColor: chartColors,
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: {
                                        size: 8
                                    }
                                }
                            },
                            datalabels: {
                                color: '#000',
                                font: {
                                    weight: 'bold',
                                    size: 8
                                },
                                formatter: (value, ctx) => {
                                    let label = ctx.chart.data.labels[ctx.dataIndex];
                                    return label + "\n(" + value + " คะแนน)";
                                }
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            } else {
                alert("ไม่พบคณะที่ตรงกับผลลัพธ์ของคุณ");
            }
        }
    </script>        
</body>
</html>
