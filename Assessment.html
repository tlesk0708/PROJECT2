<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบประเมินความพึงพอใจ</title>

    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert2 -->
</head>
<body>
<header>
    <div class="logo">
        <img src="detective.png" alt="Logo">
        <span>Luksood GU.</span>
    </div>
    <span style="font-size: 30px;">แบบประเมินความพึงพอใจ</span>
    <div class="right-text">
        <span>แนะนำคณะที่ใช่</span>
    </div>
</header>

<div class="body1">
    <div class="boxbodywhite">
        <form id="quizForm" action="Assessment.php" method="POST">
        <div class="whitebox">
            <div style="padding: 15px;">
                <h4>คุณชอบเว็บไซต์ของเราไหม?</h4><br>
                <input type="radio" id="q1_1" name="assessment1" value="ไม่ชอบเลย">
                <label for="q1_1">ไม่ชอบเลย</label>
    
                <input type="radio" id="q1_2" name="assessment1" value="ไม่ชอบ">
                <label for="q1_2">ไม่ชอบ</label>
    
                <input type="radio" id="q1_3" name="assessment1" value="ชอบ">
                <label for="q1_3">ชอบ</label>
    
                <input type="radio" id="q1_4" name="assessment1" value="ชอบมาก">
                <label for="q1_4">ชอบมาก</label>
            </div>
        </div>
        <div class="whitebox">
            <div style="padding: 15px;">
                <h4>ใช้คำถามที่เข้าใจง่าย?</h4><br>
                <input type="radio" id="q2_1" name="assessment2" value="ไม่เห็นด้วยเลย">
                <label for="q2_1">ไม่เห็นด้วยเลย</label>
    
                <input type="radio" id="q2_2" name="assessment2" value="ไม่ค่อยเห็นด้วย">
                <label for="q2_2">ไม่ค่อยเห็นด้วย</label>
    
                <input type="radio" id="q2_3" name="assessment2" value="เห็นด้วย">
                <label for="q2_3">เห็นด้วย</label>
    
                <input type="radio" id="q2_4" name="assessment2" value="เห็นด้วยที่สุด">
                <label for="q2_4">เห็นด้วยที่สุด</label>
            </div>
        </div>
        <div class="whitebox">
            <div style="padding: 15px;">
                <h4>คุณพึงพอใจกับคำตอบหรือไม่?</h4><br>
                <input type="radio" id="q3_1" name="assessment3" value="ไม่พอใจเลย">
                <label for="q3_1">ไม่พอใจเลย</label>
    
                <input type="radio" id="q3_2" name="assessment3" value="ไม่ค่อยพอใจ">
                <label for="q3_2">ไม่ค่อยพอใจ</label>
    
                <input type="radio" id="q3_3" name="assessment3" value="รู้สึกพอใจ">
                <label for="q3_3">รู้สึกพอใจ</label>
    
                <input type="radio" id="q3_4" name="assessment3" value="รู้สึกพอใจมาก">
                <label for="q3_4">รู้สึกพอใจมาก</label>
            </div>
        </div>
    </div>   
    <div class="botton">
        <div class="input-group">
            <p1>บันทึกคำตอบ</p1>
            <button type="submit" class="btn">Save</button>
        </div>
    </div>
    </form>
</div>
<script>
    document.getElementById("quizForm").addEventListener("submit", function(event) {
    event.preventDefault();  // ป้องกันการส่งฟอร์ม

    let assessment1 = document.querySelector('input[name="assessment1"]:checked');
    let assessment2 = document.querySelector('input[name="assessment2"]:checked');
    let assessment3 = document.querySelector('input[name="assessment3"]:checked');

    // แจ้งเตือนเมื่อกรุณาตอบคำถามให้ครบทุกข้อ
    if (!assessment1 || !assessment2 || !assessment3) {
        Swal.fire({
            title: "กรุณาตอบคำถามให้ครบทุกข้อ",
            icon: "warning",
            showConfirmButton: true,
            confirmButtonText: "ตกลง"
        });
        return;
    }

    // ดึงค่า username จาก localStorage
    let username = localStorage.getItem('username');
    
    // ตรวจสอบว่า username มีค่าหรือไม่
    if (!username) {
        Swal.fire({
            title: "คุณยังไม่ได้ล็อกอิน",
            icon: "error"
        });
        return;
    }

    // ตรวจสอบค่า username
    console.log("Username: ", username);

    // ถ้าตอบครบแล้ว, ส่งข้อมูลไปยัง server
    let formData = new FormData(document.getElementById("quizForm"));

    // เพิ่ม username เข้าไปใน formData
    formData.append("username", username);

    fetch("Assessment.php", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            Swal.fire({
                title: "บันทึกคำตอบสำเร็จ",
                icon: "success",
                timer: 2000,
                showConfirmButton: false
            }).then(function() {
                window.location.href = "dashboard.html"; // ไปยังหน้าหลัก
            });
        } else {
            // ถ้าผู้ใช้ทำแบบประเมินนี้ไปแล้ว
            Swal.fire({
                title: "คุณทำแบบประเมินนี้ไปแล้ว",
                icon: "error"
            }).then(function() {
                window.location.href = "dashboard.html"; // ไปยังหน้าหลักเมื่อกด OK
            });
        }
    })
    .catch(error => {
        Swal.fire({
            title: "เกิดข้อผิดพลาด",
            text: error,
            icon: "error"
        });
    });
});
</script>

</body>
</html>
